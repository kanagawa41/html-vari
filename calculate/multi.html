<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>Enjoy calculate</title>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap/bootstrap.min.js"></script>
<link href="css/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="js/ticker.js"></script>
<link href="css/multi.css" rel="stylesheet">
</style>
</head>

<body>
	<div id="contents">
		<div id="content-top"></div>
		<div id="multiplication_content">
			<p>
				<label id="number_of_steps">Selected Type!!</label>
			</p>
			<table class="culculate_area">
				<tr valign="middle">
					<td>
						<div id="number1" class="number digit-3">000</div>
					</td>
					<td>
						<div class="operator">×</div>
					</td>
					<td>
						<div id="number2" class="number digit-3">000</div>
					</td>
					<td>
						<div class="operator">＝</div>
					</td>
					<td>
						<div id="result" class="number digit-3">000</div>
					</td>
				</tr>
			</table>
			<div class="progress">
				<div id="calculate-progress" class="progress-bar" role="progressbar"
					aria-valuenow="0" aria-valuemin="0" aria-valuemax="0"
					style="width: 0%">
					<span class="sr-only"></span>
				</div>
			</div>

			<p>
				<button id="control_btn" class="btn btn-success btn-block"
					onclick="ButtonTypeJudge()">Start</button>
			</p>
			<button type="button" id="detail-btn"
				class="btn btn-secondary btn-block" data-toggle="collapse"
				data-target="#detail-collapse">Detail settings</button>
			<div id="detail-collapse" class="settings collapse">
				<p>
					<select id="visual_mode" class="form-control">
						<option value="normal">Normal mode</option>
						<option value="concentration" selected>Concentration mode
						</option>
					</select>
				</p>
				<p>
					<select id="study_mode" class="form-control">
						<option value="test">Test</option>
						<option value="memorization" selected>Memorization</option>
					</select>
				</p>
                <p>
                    <select id="target_step" class="form-control">
                        <option value="all">1~19 paragraph</option>
                        <option value="two_for" selected>2~19 paragraph</option>
                        <option value="eleven_for">12~19 paragraph</option>
                        <option value="choses">choses paragraph</option>
                        <option value="test">※Test※</option>
                    </select>
                </p>
				<p>
				<div id="choses_paragraphs" class="form-group"></div>
				<p>
				<p>
					<select id="display_second" class="form-control">
						<option value="2000">2 second</option>
						<option value="1500" selected>1.5 second</option>
						<option value="1000">1 second</option>
						<option value="500">0.5 second</option>
						<option value="300">0.3 second</option>
					</select>
				</p>
				<p>
					<select id="char_mode" class="form-control">
						<option value="flat">Flat</option>
						<option value="dinamic-emphasis" selected>Dynamic only
							emphasis</option>
						<option value="emphasis">Emphasis</option>
					</select>
				</p>
			</div>
		</div>
	</div>
	<script type="text/javascript">
        commonInit();

        function commonInit() {
            jQuery.fn.center = function() {
                this.css("position", "absolute");
                this.css("top", ($(window).height() - this.height()) / 2
                        + $(window).scrollTop() + "px");
                this.css("left", ($(window).width() - this.width()) / 2
                        + $(window).scrollLeft() + "px");
                return this;
            };
            $("#contents").center();

            makeNumberCheckbox(2, 19, '#choses_paragraphs');

            multiInit();
        }

        function multiInit() {
            $('#content-top').after($('#multiplication_content'));

            selectSetting();
            $("select#char_mode").change();
            $("select#target_step").change();

            multiReset();
        }

        function selectSetting() {
            $("select#char_mode").change(function() {
                $("select#char_mode option:selected").each(function() {
                    var mode = $(this).val();

                    if (mode === 'flat') {
                        changeCharEmpasis('#number1', 'emphasis-1');
                        changeCharEmpasis('#number2', 'emphasis-1');
                        changeCharEmpasis('#result', 'emphasis-1');
                    } else if (mode === 'dinamic-emphasis') {
                        changeCharEmpasis('#number1', 'emphasis-1');
                        changeCharEmpasis('#number2', 'emphasis-2');
                        changeCharEmpasis('#result', 'emphasis-2');
                    } else if (mode === 'emphasis') {
                        changeCharEmpasis('#number1', 'emphasis-1');
                        changeCharEmpasis('#number2', 'emphasis-2');
                        changeCharEmpasis('#result', 'emphasis-3');
                    } else {
                        alert('Fatal char init.');
                    }
                });
            });

            $("select#target_step")
                    .change(
                            function() {
                                $("select#target_step option:selected")
                                        .each(
                                                function() {
                                                    var mode = $(this).val();

                                                    if (mode === 'choses') {
                                                        $("#choses_paragraphs")
                                                                .show();
                                                    } else {
                                                        $("#choses_paragraphs")
                                                                .hide();
                                                        $(
                                                                '#choses_paragraphs .checkbox-inline input[type="checkbox"]')
                                                                .prop(
                                                                        'checked',
                                                                        false);
                                                    }
                                                });
                            });
        }

        function changeCharEmpasis(idOrClass, addClass) {
            $(idOrClass).removeClass('no-emphasis');
            $(idOrClass).removeClass('emphasis-1');
            $(idOrClass).removeClass('emphasis-2');
            $(idOrClass).removeClass('emphasis-3');

            $(idOrClass).addClass(addClass);
        }

        function calculateStop() {
            countTicker.exit();
            numberTicker.exit();

            multiReset();
        }

        function multiReset() {
            $('#number_of_steps').text('Selected Type!!');

            if ($('#visual_mode').val() == 'concentration') {
                switchVisual(true);
            }

            $('#control_btn').text('Start');
            type = 'start';
        }

        function switchVisual(flag) {
            if (flag) {
                $('.progress').removeClass('disable-background-color');
                $('#calculate-progress')
                        .removeClass('disable-background-color');

                $('#control_btn').removeClass('disable-background-color');
                $('#detail-btn').removeClass('disable-background-color');
                $('#detail-btn').removeClass('disable-font-color');

                $('#detail-collapse').collapse('show');
            } else {
                $('.progress').addClass('disable-background-color');
                $('#calculate-progress').addClass('disable-background-color');

                $('#control_btn').addClass('disable-background-color');
                $('#detail-btn').addClass('disable-background-color');
                $('#detail-btn').addClass('disable-font-color');

                $('#detail-collapse').collapse('hide');
            }
        }

        var type = 'start'; // or stop
        function ButtonTypeJudge() {
            if (type === 'start') {
                calculateStart();
            } else {
                calculateStop();
            }
        }

        var countTicker = new Ticker();
        var numberTicker = new Ticker();

        function calculateStart() {
            var targetStep = $('#target_step').val();

            var studyMode = $('#study_mode').val() == 'test' ? true : false;

            var targetSteps = [];
            if (targetStep === 'all') {
                targetSteps = makeSteps_(1, 19, 1, 19, false, studyMode);
            } else if (targetStep === 'eleven_for') {
                targetSteps = makeSteps_(11, 19, 11, 19, false, studyMode);
            } else if (targetStep === 'two_for') {
                targetSteps = makeSteps_(2, 19, 11, 19, true, studyMode);
            } else if (targetStep === 'choses') {
                $('#choses_paragraphs :checked').each(
                        function() {
                            var step = $(this).val();
                            Array.prototype.push.apply(targetSteps, makeSteps_(
                                    step, step, 2, 19, true, studyMode));
                        });
            } else if (targetStep === 'test') {
                targetSteps = makeSteps_(1, 2, 1, 2, false, studyMode);
            } else {
                alert("hasn't exist step was selected");
                return;
            }

            $('#control_btn').text('Stop');

            type = 'stop';

            $('#number1').text('000');
            $('#number2').text('000');
            $('#result').text('000');

            $('#calculate-progress').attr('aria-valuemax', targetSteps.length);
            $('#calculate-progress').attr('aria-valuenow', '0');
            $('#calculate-progress').css('width', '0%');

            if ($('#visual_mode').val() == 'concentration') {
                switchVisual(false);
            }

            $('#number_of_steps').text('3');

            countTicker = new Ticker();

            countTicker.intervalFor(function(count) {
                $('#number_of_steps').text(3 - count);
            }, 3);

            countTicker.run(function() {
                $('#number_of_steps').text('\u00a0');

                numberTicker = new Ticker();

                numberTicker.interval = $('#display_second').val();

                numberTicker.intervalFor(
                        function(count) {
                            try {
                                var targetStep = targetSteps[count - 1];

                                $('#number1').text(targetStep[0]);
                                $('#number2').text(targetStep[1]);
                                $('#result').text(targetStep[2]);

                                $('#calculate-progress').attr('aria-valuenow',
                                        (count));
                                $('#calculate-progress').css(
                                        'width',
                                        ((count / targetSteps.length) * 100)
                                                + '%');
                            } catch (e) {
                                //nothing
                            }
                        }, targetSteps.length);

                numberTicker.run(function() {
                    multiReset();

                    $('#number_of_steps').text('Finish!');
                }, true);

            });
        }

        function makeNumberCheckbox(min, max, element) {
            var parent = $(element);
            for (var i = min; i <= max; i++) {
                parent
                        .append('<label class="checkbox-inline"><input type="checkbox" value="' + i + '">'
                                + i + '</label>');
            }
        }

        function makeSteps_(stepMin, stepMax, columnMin, columnMax,
                oneExclusionFlag, testFlag) {
            var gathers = [];
            for (var i = stepMin; i <= stepMax; i++) {
                if (oneExclusionFlag && (i == 1 || i == 10))
                    continue;
                for (var j = columnMin; j <= columnMax; j++) {
                    if (oneExclusionFlag && (j == 1 || j == 10))
                        continue;

                    if (testFlag) {
                        var pair = [];
                        pair.push(i);
                        pair.push(j);
                        pair.push('');

                        gathers.push(pair);

                        pair = [];
                        pair.push(i);
                        pair.push(j);
                        pair.push(i * j);

                        gathers.push(pair);
                    } else {
                        var pair = [];
                        pair.push(i);
                        pair.push(j);
                        pair.push(i * j);

                        gathers.push(pair);
                    }
                }
            }
            return gathers;
        }

        function spaceFill(target, digit) {
            var different = digit - target.toString().length;
            if (different <= 0) {
                return target;
            }

            for (var i = 0; i < different; i++) {
                target = '\u00a0' + target.toString();
            }

            return target;
        }
    </script>
</body>

</html>